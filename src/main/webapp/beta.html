<!DOCTYPE html>
<html lang="en">
	<head>
	    <meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	    <title>EgyQuotes</title>
		<script src="//code.jquery.com/jquery.js"></script>
<!--		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular.min.js"></script> -->
		
		<link rel="stylesheet" href="glyphicons/glyphicons.css">
		
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
		<!-- Optional theme --
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
		<!--  -->
		
		<!-- Latest compiled and minified JavaScript -->
		<!-- -->
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		<!-- -->
		
		<script src="//cdnjs.cloudflare.com/ajax/libs/jade/1.3.1/jade.min.js"></script>
		
		
		<link rel="stylesheet" href="//cdn.datatables.net/1.10.5/css/jquery.dataTables.min.css">
		<script src="//cdn.datatables.net/1.10.5/js/jquery.dataTables.min.js"></script>
		
		<link rel="stylesheet" href="//cdn.datatables.net/plug-ins/f2c75b7247b/integration/bootstrap/3/dataTables.bootstrap.css">
		<script src="//cdn.datatables.net/plug-ins/f2c75b7247b/integration/bootstrap/3/dataTables.bootstrap.js"></script>
		
		
		<!--  Controllers: -->
		
		<script src="js/ctrl/dataTable_quote.js"></script>
		<script src="js/ctrl/dataTable_myQuote.js"></script>
		
		<script src="js/ctrl/video.js"></script>
		<script src="js/ctrl/quote.js"></script>
		<script src="js/ctrl/TimeLine.js"></script>
		
		<!--  Services: -->
		<script src="js/svc/YTSvc.js"></script>
		<script src="js/svc/VideoSvc.js"></script>
		<script src="js/svc/PersonSvc.js"></script>
		<script src="js/svc/QuoteSvc.js"></script>
		<script src="js/svc/ChannelSvc.js"></script>
		
		
		<style>
/* enable absolute positioning */
.inner-addon {
  position: relative;
  z-index: 10;
}

/* style glyph */
.inner-addon .glyphicon {
  position: absolute;
  padding: 10px;
  pointer-events: none;
}

/* align glyph */
.left-addon .glyphicon  { left:  0px;}
.right-addon .glyphicon { right: 0px;}

/* add padding  */
.left-addon input  { padding-left:  30px; }
.right-addon input { padding-right: 30px; }
		
body{
	padding-top: 70px;
	background-color: #282828;
}

.panel-default>.panel-heading
{
	color: #cccccc;
	background-color: #646464;
	border-color: #cccccc;
}
.panel-default
{
	background-color: #747474;
	color: #cccccc;
	border-color:#999999;
}


.navbar-default
{
	color: #cccccc;
	background-color: #999999;
	border-color: #cccccc;
}
.navbar-default .navbar-nav>li>a
{
	color:	#282828;
}
.navbar-default .navbar-nav>li>a:hover
{
	color:	#cccccc;
}
.clickable
{
	cursor:pointer;
	color: #cccccc;
}
.clickable:hover
{
	cursor:pointer;
	color: #999999;
}
		</style>
	</head>
		<body align="center">
<script type="jade" id="jade">
#menu
	.panel.col-xs-10.col-xs-offset-1
		.panel-body
			.panel.clickable.col-xs-10.col-sm-4.col-xs-offset-1(style="background-color: green")
				.panel-body
					span.glyphicons.glyphicons-settings(style="font-size:150px")
			.panel.clickable.col-xs-10.col-sm-4.col-xs-offset-2(style="background-color: blue")
				.panel-body
					span.glyphicons.glyphicons-conversation(style="font-size:150px")
			.panel.clickable.col-xs-10.col-sm-4.col-xs-offset-1(style="background-color: orange")
				.panel-body
					span.glyphicons.glyphicons-group(style="font-size:150px")
			.panel.clickable.col-xs-10.col-sm-4.col-xs-offset-2(style="background-color: yellow")
				.panel-body
					span.glyphicons.glyphicons-display(style="font-size:150px")

#settings

#connect

#people

#channels

</script>
<script>

var YTPlayer;
function error(jqXHR,textStatus,errorThrown){
	$('#error').find('.modal-body').text(jqXHR.responseText.substring(jqXHR.responseText.indexOf('<title>')+7,jqXHR.responseText.indexOf('</title>')));
	$('#error').modal({show:true});
}
function message(txt){
	$('#error').find('.modal-body').html(txt);
	$('#error').modal({show:true});
}




		
		
var data={
		store:function(){
			var d=[];
			if(localStorage.getItem("clips")!=undefined)
				d=JSON.parse(localStorage.getItem("clips"));
			var i,quotes=$('.quote');
			for(i=0;i<d.length;i++)
				if(d[i].videoId==video.videoId)
				{
					d.splice(i, 1);
					i--;
				}
			for(i=0;i<video.clips.length;i++)
				d.push({
					quote:$(quotes[i]).val(),
					start:video.clips[i][0],
					end:video.clips[i][1],
					videoId:video.videoId
				});
			localStorage.setItem("clips",JSON.stringify(d));
			$('#data').val(JSON.stringify(d));
		},
		transfer:function(txt){
			localStorage.setItem("clips",$('#data').val());
			$('#modal').modal('hide');
		},
		load:function(){
			var d=[];
			if(localStorage.getItem("clips")!=undefined)
			{
				d=JSON.parse(localStorage.getItem("clips"));
				if(d!=undefined)
				{
					video.clips=[];
					for(var i=0;i<d.length;i++)
						if(d[i].videoId==video.videoId)
							video.clips.push([d[i].start,d[i].end]);
					console.log(d);
					video.updateProgress();
					var p=0;
					for(var i=0;i<d.length;i++)
						if(d[i].videoId==video.videoId)
							$($('.quote')[p++]).val(d[i].quote);
				}
				$('#data').val(JSON.stringify(d));
			}
			prvPanel.loadQuotes(d);
		}
};

var prvPanel={
		quotes:[],
		load:function(quote){
			
			YTSvc.getData(quote.videoId,function(data){
				$('#vidThumbnail').attr('src',data.thumbnail);
				$('#vidCaption').text(data.channel.title+"<br>"+data.title);
			});
		},
		loadQuotes:function(d){
			prvPanel.quotes=d;
			var html='';
			for(var i=0;i<d.length;i++)
					html+='tr\n'
							+'\ttd '+d[i].quote+'\n';
			$('#prvPanel').html(jade.render(html));
			prvPanel.setListeners();
		},
		setListeners:function(){
			$('#prvPanel tr').click(function(){
				$('#prvPanel tr').removeClass('success');
				$(this).addClass('success');
				prvPanel.load(prvPanel.quotes[$('#prvPanel tr').index(this)]);
			});
		}
};



var fbprv={
		loadPosts:function(quoteIds){
			var html='<div id="fb-root"'+'><'+'/div><'+'script'+
			'>(function(d, s, id) {  var js, fjs = d.getElementsByTagName(s)[0];  if (d.getElementById(id)) return;  js = d.createElement(s); js.id = id;  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";  fjs.parentNode.insertBefore(js, fjs);}(document, \'script\', \'facebook-jssdk\'));<'+'/script>';
			
			for(var i=0;i<quoteIds.length;i++)
				html+='<div class="fb-post" style="display:none;position:absolute;" data-href="https://www.facebook.com/EgyQuotes/posts/'+quoteIds[i]+'" data-width="350"></div>';
			$('#fbprv').html(html);
			$('#fbprv').css('display','');
			if(FB!=undefined && FB!=null)
				FB.init({ xfbml      : true,
			          version    : 'v2.1'});
		},
		showPost:function(quoteId){
			var post=$('.fb-post[data-href*='+quoteId+']');
			if(post.css('display')=='') return;
			
			post.appendTo('body');
			post.css('position','absolute');
			post.css('left',($('#video').position().left+($('#video').width()>>1)-(post.width()>>1))+'px');
			post.css('top',($('#video').position().top+$('#video').height()-post.height())+'px');
			post.css('display','').hide().fadeIn();
		},
		hidePost:function(quoteId){
			var post=$('.fb-post[data-href*='+quoteId+']');
			post.fadeOut(2000).hide().css('display','none');
		}
};

var channelEvents={
		channelId:-1,
		modal:function(){
			YTSvc.getData(video.videoId,function(data){
				$('#chlModalThumbnail').attr('src',data.channel.thumbnail);
				$('#chlModalCaption').text(data.channel.title);
				channelEvents.channelId=data.channel.id;
			});
		},
		insert:function(){
			ChannelSvc.insert(channelEvents.channelId,function(){
				$('#chlModal').modal('hide');
			});
		},
		load:function(){
			ChannelSvc.list(0,100,function(channels){
				$('#prvChannels').closest('.panel').css('display','');
				for(var i=0;i<channels.length;i++)
					YTSvc.getChannelData(channels[i].key.name,function(channelData){
						var d=$('<div>');
						d.addClass('thumbnail');
						d.addClass('col-sm-2 col-md-2 col-lg-1');
						d.html(jade.render('img(data-src="holder.js/300x300",src="'+channelData.thumbnail+'")\n.caption '+channelData.title));
						d.click(function(){
							location.href="http://youtube.com/channel/"+channelData.id;
						});
						d.appendTo($('#prvChannels'));
					});
			});
		}
};



$(function(){
	
	$("body").html(
		    jade.render($('#jade').html(), {})
		  );
	//channelEvents.load();
	/* dataTable_quote.init('#dataTable_quote');
	
	
	if(location.href.indexOf('v=')>-1)
		video.loadURL('youtu.be/'+location.href.substring(location.href.indexOf('v=')+2,location.href.length));
	
	if(location.href.indexOf('access_token')>-1)
		localStorage.setItem('access_token',
				location.href.substring(location.href.indexOf('access_token=')+13,location.href.length));
	
	if(localStorage.getItem('access_token')!=null
			&& localStorage.getItem('access_token')!=undefined)
		$.ajax({
			url:'https://graph.facebook.com/me?access_token='+localStorage.getItem('access_token'),
			type:'GET',
			success:function(response){
				$('#MainMenuTitle').html(jade.render('| '+response.name+'\nspan.caret'));
				$('#MainMenuLogOutButton').css('display','');
		    }
		}); */
});



		function onYouTubeIframeAPIReady() {
			console.log('YT Ready');
			video.isYTAPIReady=true;
		  }
</script>
<!-- <script src="https://www.youtube.com/iframe_api?enablejsapi=1"></script> -->
  </body>
  </html>