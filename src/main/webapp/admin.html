<!DOCTYPE html>
<html lang="en">
	<head>
	    <meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	    <title>EgyQuotes</title>
		<script src="//code.jquery.com/jquery.js"></script>
<!--		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular.min.js"></script> -->
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
		<!-- Optional theme -->
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
		
		<link rel="stylesheet" href="//cdn.datatables.net/1.10.5/css/jquery.dataTables.min.css">
		<script src="//cdn.datatables.net/1.10.5/js/jquery.dataTables.min.js"></script>
		
		<!-- Latest compiled and minified JavaScript -->
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/jade/1.3.1/jade.min.js"></script>
		
		
	</head>
		<body style='background-color: #f9faf7;' align="center">
<script type="jade" id="jade">
.navbar.navbar-default.navbar-static-top
	.container
		.navbar-brand EgyQuotes
		button.navbar-toggle.col-xs-3(data-toggle="collapse",data-target=".navbar-collapse")
			span.glyphicon.glyphicon-option-horizontal(style="font-size:32px")
		ul.nav.navbar-nav.navbar-right.collapse.navbar-collapse
			il
				button#loginbtn.btn.btn-primary.btn-lg(onclick="location.href='https://www.facebook.com/dialog/oauth?client_id=1048399691842414&redirect_uri=https://egyquotes.appspot.com/FBUser/&scope=email&state=admin';") Login via Facebook
.container-fluid
	.row
		table#Quote.table
	.row
		table#User.table
</script>
<script>

var table={};

$(function(){
	
	$("body").html(
		    jade.render($('#jade').html(), {})
		  );
	$("#Quote").DataTable({
		processing:true,
		serverSide:true,
		//scrollY:'200px',
		ajax:
		{
			url:'/datatable/user?access_token='+localStorage.getItem('access_token'),
			type:'POST'
		},
		drawCallback:function(settings){
		},
		columns:[ {
                    title:'Edit',
                "class":          "edit",
                "orderable":      false,
                "data":           null,
                "defaultContent": "Edit"
                },
                {
                    title:'Delete',
                "class":          "delete",
                "orderable":      false,
                "data":           null,
                "defaultContent": "Delete"
                },

				{data: "key.name", title:"Id"}
			]
		});    
	
	$("#User").DataTable({
		processing:true,
		serverSide:true,
		//scrollY:'200px',
		ajax:
		{
			url:'/datatable/quote?access_token='+localStorage.getItem('access_token'),
			type:'POST'
		},
		drawCallback:function(settings){
		},
		columns:[ {
                    title:'Edit',
                "class":          "edit",
                "orderable":      false,
                "data":           null,
                "defaultContent": "Edit"
                },
                {
                    title:'Delete',
                "class":          "delete",
                "orderable":      false,
                "data":           null,
                "defaultContent": "Delete"
                },

				{data: "properties.videoId", title:"videoId"},
				{data: "properties.quote", title:"quote"},
				{data: "properties.start", title:"start"},
				{data: "properties.end", title:"end"}
			]
		});    
	
	
	if(location.href.indexOf('access_token')>-1)
		localStorage.setItem('access_token',
				location.href.substring(location.href.indexOf('access_token=')+13,location.href.length));
	
	if(localStorage.getItem('access_token')!=null
			&& localStorage.getItem('access_token')!=undefined)
		$.ajax({
			url:'https://graph.facebook.com/me?access_token='+localStorage.getItem('access_token'),
			type:'GET',
			success:function(response){
				$('#loginbtn').text(response.name);
				$('#loginbtn').removeClass('btn-primary');
				$('#loginbtn').addClass('btn-default');
				$('#loginbtn').click(function(){
					localStorage.setItem('access_token','');
					$(this).text('Logged out');
				});
				$('#loginbtn').mouseover(function(){
					$(this).text('Log out');
				});
				$('#loginbtn').mouseup(function(){
					$(this).text(response.name);
				});
		    }
		});
});

</script>
  </body>
  </html>