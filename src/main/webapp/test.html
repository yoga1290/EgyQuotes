<!DOCTYPE html>
<html lang="en">
	<head>
	    <meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	    <title>EgyQuotes</title>
		<script src="//code.jquery.com/jquery.js"></script>
<!--		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular.min.js"></script> -->
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
		<!-- Optional theme -->
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
		<!-- Latest compiled and minified JavaScript -->
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/jade/1.3.1/jade.min.js"></script>
		
		
		<link rel="stylesheet" href="//cdn.datatables.net/1.10.5/css/jquery.dataTables.min.css">
		<script src="//cdn.datatables.net/1.10.5/js/jquery.dataTables.min.js"></script>
		<script src="js/ctrl/dataTable_quote.js"></script>
		<link rel="stylesheet" href="//cdn.datatables.net/plug-ins/f2c75b7247b/integration/bootstrap/3/dataTables.bootstrap.css">
		<script src="//cdn.datatables.net/plug-ins/f2c75b7247b/integration/bootstrap/3/dataTables.bootstrap.js"></script>
		
		<style>
/* enable absolute positioning */
.inner-addon {
  position: relative;
  z-index: 10;
}

/* style glyph */
.inner-addon .glyphicon {
  position: absolute;
  padding: 10px;
  pointer-events: none;
}

/* align glyph */
.left-addon .glyphicon  { left:  0px;}
.right-addon .glyphicon { right: 0px;}

/* add padding  */
.left-addon input  { padding-left:  30px; }
.right-addon input { padding-right: 30px; }
		
body{
	padding-top: 70px;
}
		</style>
	</head>
		<body style='background-color: #f9faf7;' align="center">
		<table id="table"></table>
<script>
var QuoteOwnerSvc={
		all:function(success){
			return $.ajax({
				url:'/quoteowner/all',
				type:'GET',
				success:success
			});
		},
		findById:function(quoteId,success){
			return $.ajax({
				url:'/quoteowner/id/'+quoteId,
				type:'GET',
				success:success
			});
		},
		insert:function( userId,success){
			return $.ajax({
				url:'/quoteowner/insert',
				type:'POST',
				data:'userId='+userId
								,
				success:success
			});
		},
		insertForm:function(formObj,success){
			return $.ajax({
				url:'/quoteowner/insert',
				type:'POST',
				data:$(formObj).serialize(),
				success:success
			});
		},
		insertAll:function( userId,success){
			return $.ajax({
				url:'/quoteowner/insertAll',
				type:'POST',
				//data:,
				success:success
			});
		},
		update:function(id, userId,success){
			return $.ajax({
				url:'/quoteowner/update/'+id,
				type:'POST',
				data:'userId='+userId
								,
				success:success
			});
		},
		updateForm:function(id,formObj,success){
			return $.ajax({
				url:'/quoteowner/update/'+id,
				type:'POST',
				data:$(formObj).serialize(),
				success:success
			});
		},
		updateAll:function( quoteId,userId,success){
			return $.ajax({
				url:'/quoteowner/updateAll',
				type:'POST',
				data:'quoteId='+JSON.stringify(quoteId)
								+'&userId='+JSON.stringify(userId)
								,
				success:success
			});
		},
		deleteAll:function(quoteId,success){
			return $.ajax({
				url:'/quoteowner/deleteAll',
				type:'POST',
				data:'quoteId='
						+JSON.stringify(quoteId),
				success:success
			});
		},
		delete:function(quoteId,success){
			return $.ajax({
				url:'/quoteowner/delete',
				type:'POST',
				data:'quoteId='
						+quoteId,
				success:success
			});
		}
	};
var datatable_QuoteOwner={
		api:{},
		table:{},
		DDL:{},
		DDL_KVC:{},
		order:'asc',
		colName:'',
		getEditTemplate:function(row){
			return '<form onsubmit="return false;"><table>'
							
	+'<tr><td>userId</td><td><input type="text" name="userId" value="'+row.userId+'" ></td></tr>'
						+'<tr>'
							+'<td colspan="2"><button onclick="datatable_QuoteOwner.actions.edit('+row.quoteId+',$(this).closest(\'form\'));">Update</button></td>'
						+'</tr>'
					+'</table></form>';
		},
		getInsertTemplate:function(){
			return '<form onsubmit="return false;"><table>'
							
						+'<tr>'
							+'<td colspan="2"><button onclick="datatable_QuoteOwner.actions.insert($(this).closest(\'form\'));">Insert</button></td>'
						+'</tr>'
					+'</table></form>';
		},
		bindTemplateDDL:function(Template){
			$(Template).find('select').each(function(i,o){
				var name=$(this).attr('name');
	            var i,html="";
	            if(datatable_menu.DDL[name+""]!=undefined)
	            for(i=0;i<datatable_menu.DDL[name+""].length;i++)
	                html+="<option value='"+datatable_menu.DDL[name+""][i][""+datatable_menu.DDL_KVC[name+""].key]+"'>"+datatable_menu.DDL[name+""][i][""+datatable_menu.DDL_KVC[name+""].value]+"</option>";
	            $(this).html(html);
			});
		},
		bindEditTemplateDDL:function(){
			$('#datatable_QuoteOwner tbody tr select').each(function(i,o){
				var name=$(this).attr('name');
	            var i,html="";
	            //var row=$(o).parent().parent().parent().parent().parent().parent().parent().prev();
	            var row=$(o).parents('tr').last().prev();
	            var data=datatable_QuoteOwner.api.row(row).data();
	            if(datatable_QuoteOwner.DDL[name+""]!=undefined)
	            for(i=0;i<datatable_QuoteOwner.DDL[name+""].length;i++)
	            {
	                if(data[name+""]==datatable_QuoteOwner.DDL[name+""][i][""+datatable_QuoteOwner.DDL_KVC[name+""].key])
	                    html+="<option value='"+datatable_QuoteOwner.DDL[name+""][i][""+datatable_QuoteOwner.DDL_KVC[name+""].key]+"' selected>"+datatable_QuoteOwner.DDL[name+""][i][""+datatable_QuoteOwner.DDL_KVC[name+""].value]+"</option>";
	                else
	                    html+="<option value='"+datatable_QuoteOwner.DDL[name+""][i][""+datatable_QuoteOwner.DDL_KVC[name+""].key]+"'>"+datatable_QuoteOwner.DDL[name+""][i][""+datatable_QuoteOwner.DDL_KVC[name+""].value]+"</option>";
	            }
	            $(this).html(html);
			});
		},
		bindEditTemplate:function(row,template){
			//TODO: Bind DDL; find elements by form name (template.find('[name=IsDeleted]'))
			template.find('input[mask]').each(function(i,o){
				$(o).mask($(o).attr('mask'));
			});
			template.find('.datepicker').each(function(i,o){
				$(o).datepicker("option", "dateFormat", "Y-m-d H:i:s" );
			});
			
			
		},
		actions:{
			insert:function(form){
				QuoteOwnerSvc.insertForm(form,function(){
	            	datatable_QuoteOwner.api.draw(false);
	                datatable_QuoteOwner.setListeners();
	            });
			},
			edit:function(id,form){
			
	            QuoteOwnerSvc.updateForm(id,form,function(){
	            	datatable_QuoteOwner.api.draw(false);
	                datatable_QuoteOwner.setListeners();
	            });

				$(datatable_QuoteOwner.table).find(' tr.selected').each(function(i,o){
					$(o).removeClass('selected');
				});
			},
			delete:function(o){
				var quoteId
						=datatable_QuoteOwner.api.row($(o).closest('tr'))
							.data().quoteId;

					QuoteOwnerSvc.delete(quoteId,function(){
						//de-select the item(s)
						$(datatable_QuoteOwner.table).find(' tr.selected')
							.each(function(i,o){
			                	$(o).removeClass('selected');
			            });
			            datatable_QuoteOwner.api.draw(false);
			            datatable_QuoteOwner.setListeners();
					});

				
			},
			deleteAll:function(){
				var quoteId=[];
				$(datatable_QuoteOwner.table).find(' tr.selected').each(function(i,o){
					$(o).removeClass('selected');

					quoteId
						.push(
							datatable_QuoteOwner.api.row($(o))
							.data().quoteId
							);
				});
				QuoteOwnerSvc.deleteAll(quoteId,function(){
						//de-select the item(s)
						$(datatable_QuoteOwner.table).find(' tr.selected')
							.each(function(i,o){
			                	$(o).removeClass('selected');
			            });
			            datatable_QuoteOwner.api.draw(false);
			            datatable_QuoteOwner.setListeners();
					});
			}
		},
		setListeners:function(){
			$(datatable_QuoteOwner.table).find( ' tbody').on('click','tr td.edit',function(){
				var row=datatable_QuoteOwner.api.row($(this).closest('tr'));
				debug=row;
				if(row.child.isShown())
					row.child.hide();
				else
				{
					row.child(
							datatable_QuoteOwner.getEditTemplate(row.data())
						).show();
					datatable_QuoteOwner.bindEditTemplate(row.data(),row.child());
				}
			});
			$(datatable_QuoteOwner.table).find( ' tbody').on('click','tr td.delete',function(){
				datatable_QuoteOwner.actions.delete(this);
			});
			$(datatable_QuoteOwner.table).find( ' tbody').on('click','tr[role=row]',function(){
				$(this).toggleClass('selected');
			});
			$(datatable_QuoteOwner.table).find( ' td.checkbox').each(function(i,o){
				$(o).html('<input type="checkbox" '+
					( datatable_QuoteOwner.api.cell($(o)).data()=='1' ? 'checked':'')
					+' disabled/>');
			});
			$(datatable_QuoteOwner.table).find( ' td.needsDataBind').each(function(i,cell){
	            var id=datatable_QuoteOwner.api.cell($(cell)).data();            
	            var colInd=datatable_QuoteOwner.api.cell(cell)[0][0].column;
	            var colTitle=$(datatable_QuoteOwner.api.column(colInd).header()).text();

	            

	        });
		},

		init:function(table){
			datatable_QuoteOwner.table=$(table);
			datatable_QuoteOwner.api=
				$(datatable_QuoteOwner.table).DataTable({
					processing:true,
					serverSide:true,
					//scrollY:'200px',
					ajax:
					{
						url:'quoteowner/DataTable',
						type:'POST',
						data:function(d){
							// see https://datatables.net/examples/server_side/custom_vars.html
							d.order=datatable_QuoteOwner.order;
							d.colName=datatable_QuoteOwner.colName;
						}
					},
					drawCallback:function(settings){
						datatable_QuoteOwner.setListeners();
					},
					columns:[ {
			                    title:'Edit',
			                "class":          "edit",
			                "orderable":      false,
			                "data":           null,
			                "defaultContent": "Edit"
			                },
			                {
			                    title:'Delete',
			                "class":          "delete",
			                "orderable":      false,
			                "data":           null,
			                "defaultContent": "Delete"
			                },

				]

			});    

		}
	};
	$(function(){
		datatable_QuoteOwner.init($('#table'));		
	});

</script>
</body>
</html>