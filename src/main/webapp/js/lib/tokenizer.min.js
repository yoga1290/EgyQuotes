(function(d){var c="tokenizer";var b=function(g,e){var p,v,o,q,r=d({}),h=d.extend({xContent:"&times;",namespace:"tknz",label:"Tags:",placeholder:"",separators:[","," ","."],callback:null,source:null,allowUnknownTags:true,numToSuggest:5,onclick:null},e);var t,y,f,k,l,w,n,x,j,m,u,s,i;t=function(){p=g;y();f()};y=function(){var z=h.namespace;v=d('<div class="'+z+'-list"></div>');if(h.placeholder){p.attr("placeholder",h.placeholder)}q=d('<div class="'+z+'-suggest"><ul></ul></div>');o=p.addClass(z+"-input").wrap('<span class="'+z+'-input-wrapper"></span>').parent().wrap('<div class="'+z+'-wrapper"></div>').parent().prepend(v).prepend('<span class="'+z+'-wrapper-label">'+h.label+"</span>").find("."+z+"-input-wrapper").append(q).end()};f=function(){var z=h.namespace;o.on("focus","input",function(){o.addClass(z+"-focus")}).on("blur","input",function(){o.removeClass(z+"-focus");r.delay(200).queue().push(function(){s(p.val());d.dequeue(this)})}).on("keydown","input",function(C){C=C||window.event;C.which=C.which||C.keyCode||C.charCode;if(C.which===8&&!p.val()){l();j();return}var B=z+"-sel",A=q.find("."+B);if(C.which===38){C.preventDefault();if(A.length){A.removeClass(B).prev("li").add(A.siblings().last()).eq(0).addClass(B)}else{q.find("li").last().addClass(B)}}else{if(C.which===40){C.preventDefault();if(A.length){A.removeClass(B).next("li").addClass(B)}else{q.find("li").first().addClass(B)}}}}).on("keypress","input",function(A){if(h.separators.indexOf(String.fromCharCode(A.which))>-1||A.which===13){A.preventDefault();s(p.val())}}).on("keyup","input",function(A){A=A||window.event;A.which=A.which||A.keyCode||A.charCode;if(A.which===38||A.which===40){return}if(d.isArray(h.source)){m(h.source)}else{if(h.source){h.source(p.val(),m)}}}).on("click",function(){p.focus()}).on("click","."+z+"-token-x",function(A){A.stopPropagation();d(this).closest("."+z+"-token").remove();j()}).on("click","."+z+"-suggest-li",function(){d.queue(r,[]);p.val("");k(d(this).text());m([]);j()}).on("click","."+z+"-token",function(A){if(h.onclick){A.stopPropagation();h.onclick(d(this).children("."+z+"-token-label").text())}})};s=function(A){var z=u();if(A&&(h.allowUnknownTags||z)){k(z||A);p.val("");j()}m([],"")};k=function(B){var A=h.namespace,C=A+"-token",z='<div class="'+C+'" data-token="'+B+'"><span class="'+C+'-label">'+B.trim()+'</span><span class="'+C+'-x">'+h.xContent+"</span></div>";v.append(z);return p};l=function(){return v.children().last().detach().data("token")||null};n=function(){v.empty();return p};w=function(){var z,B=[],A=v.children();for(z=0;z<A.length;z++){B.push(A.eq(z).data("token").toString())}return B};x=function(){o.after(p).remove();if(h.placeholder){p.attr("placeholder","")}return p.removeClass(h.namespace+"-input")};j=function(){(h.callback||d.noop)(p);return p};m=function(G,F){F=F===undefined?p.val():F;var C,D=h.namespace,B=new RegExp(i(F),"i"),A=new RegExp("^"+i(F)+"$","i"),z=h.numToSuggest||1000,E=[];for(C=0;F&&C<G.length&&E.length<z;C++){if(!G[C].match(B)){continue}E.push('<li class="'+D+"-suggest-li"+(G[C].match(A)?" "+D+"-sel":"")+'">'+G[C]+"</li>")}q.children("ul").html(E.join("")).end()[E.length?"addClass":"removeClass"]("."+D+"-vis")};u=function(){return q.find("."+h.namespace+"-sel").eq(0).text()};i=function(z){return z.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")};t(g);return{push:k,pop:l,empty:n,get:w,destroy:x,callback:j}};var a={init:function(e){if(this[0].nodeName!=="INPUT"){d.error('Tokenizer requires an <input type="text"> tag.');return this}return this.data(c,b(this,e))},push:function(e){return this.data(c).push(e)},pop:function(){return this.data(c).pop()},empty:function(){return this.data(c).empty()},get:function(){return this.data(c).get()},destroy:function(){return this.data(c).destroy()},callback:function(){return this.data(c).callback()}};d.fn[c]=function(e){if(a[e]){if(!this.data(c)){d.error('Cannot call "'+e+'" - Tokenizer not initialized.')}return a[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return a.init.apply(this,arguments)}else{d.error("Unknown tokenizer method "+e+".")}}}}(jQuery));