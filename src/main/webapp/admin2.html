<html>
	<head>
		<meta charset="utf-8">
		<script src="//cdnjs.cloudflare.com/ajax/libs/jade/1.3.1/jade.min.js"></script>
	</head>
	<body>
<script type="jade" id="jade">
html
	head
		meta(charset="utf-8")
		meta(http-equiv="X-UA-Compatible",content="IE=edge")
		meta(name="viewport",content="width=device-width, initial-scale=1, maximum-scale=1")
		title EgyQuotes
		script(src="//code.jquery.com/jquery.js")
		link(rel="stylesheet",href="https://fonts.googleapis.com/icon?family=Material+Icons")
		link(rel="stylesheet",href="/css/animate.css")
		link(rel="stylesheet",href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css")
		link(rel="stylesheet",href="/css/style.css")

		script(src="//netdna.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js")
		script(src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.6/angular.min.js")
		script(src="/js/lib/stickingEffect.js")
		script(src="/js/config.js")
		
	body(align="center",ng-app="app",ng-controller="SettingsCtrl")
		button.btn.btn-lg.btn-default(ng-click="export()") export
		#loader
			div(style="background-color:rgba(0,0,0,0.6);top:0px;left:0px;position:fixed;width:100%;height:100%;z-index:6;")
			i.animated.material-icons.loader(style="position:fixed;z-index:6;top:30%;height:100%;left:0px;width:100%;alignment-baseline: central;color:white;") wifi
		ng-include(src="'settings.html'")
		script(src="js/lib/Base64.js")
		script(src="js/ctrl/new.js")
		script(src="js/svc.js")
		script.
			var exported=[];
			app
			.controller('SettingsCtrl',function($scope,QuoteSvc,TagSvc){
				$scope.downloaded=0;
				$scope.export=function(){
					QuoteSvc.list(0,200).success(function(response){
						angular.forEach(response,function(quote,i){
							TagSvc.findByQuoteId(quote.key.name).success(function(tags){
								quote.tags=tags;
								exported.push(quote);
								if(i==response.length-1)
									Base64.download(JSON.stringify(exported),'quotes.json');
							});							
						});
						
					});
				};
			});
</script>
<script>
window.onload=function(){

		document.write(
			jade.render(
				document.getElementById('jade').innerHTML,
				{pretty:'\t'}
			)
		);
		//AngularJS DOES NOT WORK W/OUT THIS:
		document.close();
};
</script>


</body></html>